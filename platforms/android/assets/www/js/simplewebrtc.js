/**
 * Minified by jsDelivr using UglifyJS v3.0.24.
 * Original file: /npm/simplewebrtc@3.0.1/src/simplewebrtc.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
function SimpleWebRTC(e){var t,o,i=this,n=e||{},r=this.config={url:"https://sandbox.simplewebrtc.com:443/",socketio:{},connection:null,debug:!1,localVideoEl:"",remoteVideosEl:"",enableDataChannels:!0,autoRequestMedia:!1,autoRemoveVideos:!0,adjustPeerVolume:!1,peerVolumeWhenSpeaking:.25,media:{video:!0,audio:!0},receiveMedia:{offerToReceiveAudio:1,offerToReceiveVideo:1},localVideo:{autoplay:!0,mirror:!0,muted:!0}};this.logger=e.debug?e.logger||console:e.logger||mockconsole;for(t in n)n.hasOwnProperty(t)&&(this.config[t]=n[t]);this.capabilities=webrtcSupport,WildEmitter.call(this),(o=null===this.config.connection?this.connection=new SocketIoConnection(this.config):this.connection=this.config.connection).on("connect",function(){i.emit("connectionReady",o.getSessionid()),i.sessionReady=!0,i.testReadiness()}),o.on("message",function(e){var t,o=i.webrtc.getPeers(e.from,e.roomType);"offer"===e.type?(o.length&&o.forEach(function(o){o.sid==e.sid&&(t=o)}),t||(t=i.webrtc.createPeer({id:e.from,sid:e.sid,type:e.roomType,enableDataChannels:i.config.enableDataChannels&&"screen"!==e.roomType,sharemyscreen:"screen"===e.roomType&&!e.broadcaster,broadcaster:"screen"!==e.roomType||e.broadcaster?null:i.connection.getSessionid()}),i.emit("createdPeer",t)),t.handleMessage(e)):o.length&&o.forEach(function(t){e.sid?t.sid===e.sid&&t.handleMessage(e):t.handleMessage(e)})}),o.on("remove",function(e){e.id!==i.connection.getSessionid()&&i.webrtc.removePeers(e.id,e.type)}),e.logger=this.logger,e.debug=!1,this.webrtc=new WebRTC(e),["mute","unmute","pauseVideo","resumeVideo","pause","resume","sendToAll","sendDirectlyToAll","getPeers"].forEach(function(e){i[e]=i.webrtc[e].bind(i.webrtc)}),this.webrtc.on("*",function(){i.emit.apply(i,arguments)}),r.debug&&this.on("*",this.logger.log.bind(this.logger,"SimpleWebRTC event:")),this.webrtc.on("localStream",function(){i.testReadiness()}),this.webrtc.on("message",function(e){i.connection.emit("message",e)}),this.webrtc.on("peerStreamAdded",this.handlePeerStreamAdded.bind(this)),this.webrtc.on("peerStreamRemoved",this.handlePeerStreamRemoved.bind(this)),this.config.adjustPeerVolume&&(this.webrtc.on("speaking",this.setVolumeForAll.bind(this,this.config.peerVolumeWhenSpeaking)),this.webrtc.on("stoppedSpeaking",this.setVolumeForAll.bind(this,1))),o.on("stunservers",function(e){i.webrtc.config.peerConnectionConfig.iceServers=e,i.emit("stunservers",e)}),o.on("turnservers",function(e){i.webrtc.config.peerConnectionConfig.iceServers=i.webrtc.config.peerConnectionConfig.iceServers.concat(e),i.emit("turnservers",e)}),this.webrtc.on("iceFailed",function(e){}),this.webrtc.on("connectivityError",function(e){}),this.webrtc.on("audioOn",function(){i.webrtc.sendToAll("unmute",{name:"audio"})}),this.webrtc.on("audioOff",function(){i.webrtc.sendToAll("mute",{name:"audio"})}),this.webrtc.on("videoOn",function(){i.webrtc.sendToAll("unmute",{name:"video"})}),this.webrtc.on("videoOff",function(){i.webrtc.sendToAll("mute",{name:"video"})}),this.webrtc.on("localScreen",function(e){var t=document.createElement("video"),o=i.getRemoteVideoContainer();t.oncontextmenu=function(){return!1},t.id="localScreen",attachMediaStream(e,t),o&&o.appendChild(t),i.emit("localScreenAdded",t),i.connection.emit("shareScreen"),i.webrtc.peers.forEach(function(e){var t;"video"===e.type&&(t=i.webrtc.createPeer({id:e.id,type:"screen",sharemyscreen:!0,enableDataChannels:!1,receiveMedia:{offerToReceiveAudio:0,offerToReceiveVideo:0},broadcaster:i.connection.getSessionid()}),i.emit("createdPeer",t),t.start())})}),this.webrtc.on("localScreenStopped",function(e){i.getLocalScreen()&&i.stopScreenShare()}),this.webrtc.on("channelMessage",function(e,t,o){"volume"==o.type&&i.emit("remoteVolumeChange",e,o.volume)}),this.config.autoRequestMedia&&this.startLocalVideo()}var WebRTC=require("./webrtc"),WildEmitter=require("wildemitter"),webrtcSupport=require("webrtcsupport"),attachMediaStream=require("attachmediastream"),mockconsole=require("mockconsole"),SocketIoConnection=require("./socketioconnection");SimpleWebRTC.prototype=Object.create(WildEmitter.prototype,{constructor:{value:SimpleWebRTC}}),SimpleWebRTC.prototype.leaveRoom=function(){if(this.roomName){for(this.connection.emit("leave");this.webrtc.peers.length;)this.webrtc.peers[0].end();this.getLocalScreen()&&this.stopScreenShare(),this.emit("leftRoom",this.roomName),this.roomName=void 0}},SimpleWebRTC.prototype.disconnect=function(){this.connection.disconnect(),delete this.connection},SimpleWebRTC.prototype.handlePeerStreamAdded=function(e){var t=this,o=this.getRemoteVideoContainer(),i=attachMediaStream(e.stream);e.videoEl=i,i.id=this.getDomId(e),o&&o.appendChild(i),this.emit("videoAdded",i,e),window.setTimeout(function(){t.webrtc.isAudioEnabled()||e.send("mute",{name:"audio"}),t.webrtc.isVideoEnabled()||e.send("mute",{name:"video"})},250)},SimpleWebRTC.prototype.handlePeerStreamRemoved=function(e){var t=this.getRemoteVideoContainer(),o=e.videoEl;this.config.autoRemoveVideos&&t&&o&&t.removeChild(o),o&&this.emit("videoRemoved",o,e)},SimpleWebRTC.prototype.getDomId=function(e){return[e.id,e.type,e.broadcaster?"broadcasting":"incoming"].join("_")},SimpleWebRTC.prototype.setVolumeForAll=function(e){this.webrtc.peers.forEach(function(t){t.videoEl&&(t.videoEl.volume=e)})},SimpleWebRTC.prototype.joinRoom=function(e,t){var o=this;this.roomName=e,this.connection.emit("join",e,function(i,n){if(console.log("join CB",i,n),i)o.emit("error",i);else{var r,c,s,a;for(r in n.clients){c=n.clients[r];for(s in c)c[s]&&(a=o.webrtc.createPeer({id:r,type:s,enableDataChannels:o.config.enableDataChannels&&"screen"!==s,receiveMedia:{offerToReceiveAudio:"screen"!==s&&o.config.receiveMedia.offerToReceiveAudio?1:0,offerToReceiveVideo:o.config.receiveMedia.offerToReceiveVideo}}),o.emit("createdPeer",a),a.start())}}t&&t(i,n),o.emit("joinedRoom",e)})},SimpleWebRTC.prototype.getEl=function(e){return"string"==typeof e?document.getElementById(e):e},SimpleWebRTC.prototype.startLocalVideo=function(){var e=this;this.webrtc.start(this.config.media,function(t,o){t?e.emit("localMediaError",t):attachMediaStream(o,e.getLocalVideoContainer(),e.config.localVideo)})},SimpleWebRTC.prototype.stopLocalVideo=function(){this.webrtc.stop()},SimpleWebRTC.prototype.getLocalVideoContainer=function(){var e=this.getEl(this.config.localVideoEl);if(e&&"VIDEO"===e.tagName)return e.oncontextmenu=function(){return!1},e;if(e){var t=document.createElement("video");return t.oncontextmenu=function(){return!1},e.appendChild(t),t}},SimpleWebRTC.prototype.getRemoteVideoContainer=function(){return this.getEl(this.config.remoteVideosEl)},SimpleWebRTC.prototype.shareScreen=function(e){this.webrtc.startScreenShare(e)},SimpleWebRTC.prototype.getLocalScreen=function(){return this.webrtc.localScreens&&this.webrtc.localScreens[0]},SimpleWebRTC.prototype.stopScreenShare=function(){this.connection.emit("unshareScreen");var e=document.getElementById("localScreen"),t=this.getRemoteVideoContainer();this.config.autoRemoveVideos&&t&&e&&t.removeChild(e),e&&this.emit("videoRemoved",e),this.getLocalScreen()&&this.webrtc.stopScreenShare(),this.webrtc.peers.forEach(function(e){e.broadcaster&&e.end()})},SimpleWebRTC.prototype.testReadiness=function(){var e=this;this.sessionReady&&(this.config.media.video||this.config.media.audio?this.webrtc.localStreams.length>0&&e.emit("readyToCall",e.connection.getSessionid()):e.emit("readyToCall",e.connection.getSessionid()))},SimpleWebRTC.prototype.createRoom=function(e,t){this.roomName=e,2===arguments.length?this.connection.emit("create",e,t):this.connection.emit("create",e)},SimpleWebRTC.prototype.sendFile=function(){if(!webrtcSupport.dataChannel)return this.emit("error",new Error("DataChannelNotSupported"))},module.exports=SimpleWebRTC;
//# sourceMappingURL=/sm/3f1a0e49f8ddfa4663cd6f7f08da7967eb6cc2eddb28b20322ba4295da472f27.map